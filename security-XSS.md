# 跨站脚本攻击 XSS

[TOC]

## 定义

跨站脚本攻击是指攻击者在网页中嵌入恶意脚本程序，当用户打开该网页时，脚本程序便开始在客户端的浏览器中执行，以盗取客户端 Cookie、账号密码，下载执行病毒木马程序，甚至获取客户端的 Admin 权限等

## 攻击形式

### 1. 反射型 XSS

将用户输入反射回浏览器，即将用户输入变成 HTML 代码。

假设页面有个表单用来获取用户名称 `<input name="username" value="zhangsan">` ，其中 value 值是由用户输入的，如果用户输入的不是字符串而是 `"><script>alert("哈哈！")</script><!-` ，由于服务端校验未通过而带上之前提交的数据重定向回该页面时，页面内容变成 `<input name="username" value=""><script>alert("哈哈！")</script><!-"> ` ，脚本将执行 alert 弹框。

如果注入的不是 alert 而是其他较为严重的脚本，将会产生严重危害。

### 2. 请求攻击

将恶意代码放在请求链接中。

如：`http://xxx.com?a="><script>alert("哈哈！")</script><!-` ，一般为了迷惑用户，通常会对 URL 进行 urlencode `http://xxx.com/?a=%22%3E%3Cscript%3Ealert(%22%E5%93%88%E5%93%88%EF%BC%81%22)%3C/script%3E%3C!-` ，一旦用户点击，将自动执行代码。

### 3. 存储型 XSS

将攻击脚本放置在服务端并渲染到用户可访问的页面中。

比如恶意脚本以表单的形式提交并入库成功并在另一个页面直接渲染，当用户访问渲染恶意脚本的页面时，就会受到攻击。

## 防御方法

XSS 之所以会发生是因为用户输入的数据变成了代码，因此，我们要将 HTML 代码进行转义处理。

| HTML 代码 | 转义代码 |
| --------- | -------- |
| <         | `$lt;`   |
| >         | `$gt;`   |
| '         | `&amp;`  |
| "         | `&quot;` |